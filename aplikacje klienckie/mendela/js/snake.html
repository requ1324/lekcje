<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      table {
        border: 1px solid black;
        border-collapse: collapse;
      }

      tr {
        border: 1px solid black;
      }

      td {
        border: 1px solid black;
        width: 30px;
        height: 30px;
      }

      .snake {
        background-color: green;
      }

      .apple {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <div id="score" style="font-size: 1.5rem; margin-bottom: 30px">
      Score: 0
    </div>
    <table id="table"></table>
    <script>
      let size = 20;
      let snake = [[10, 10]];
      let apple = [];
      let direction;
      let score = 0;
      let gameRunning = false;

      for (let i = 1; i <= size; i++) {
        let tr = document.createElement("tr");
        for (let j = 1; j <= size; j++) {
          let td = document.createElement("td");
          td.setAttribute("id", `td${i}-${j}`);
          tr.append(td);
        }
        document.querySelector("#table").append(tr);
      }

      function generateApple() {
        let row, col;
        do {
          row = Math.floor(Math.random() * size) + 1;
          col = Math.floor(Math.random() * size) + 1;
        } while (
          snake.some((segment) => segment[0] === row && segment[1] === col)
        );
        apple = [row, col];
        document.getElementById(`td${row}-${col}`).classList.add("apple");
      }

      function updateBoard() {
        for (let i = 1; i <= size; i++) {
          for (let j = 1; j <= size; j++) {
            document.getElementById(`td${i}-${j}`).className = "";
          }
        }

        snake.forEach((segment) => {
          document
            .getElementById(`td${segment[0]}-${segment[1]}`)
            .classList.add("snake");
        });

        if (apple.length > 0) {
          document
            .getElementById(`td${apple[0]}-${apple[1]}`)
            .classList.add("apple");
        }
      }

      function moveSnake() {
        if (!gameRunning) return;
        let head = [...snake[0]];
        if (direction === "up") head[0]--;
        else if (direction === "down") head[0]++;
        else if (direction === "left") head[1]--;
        else if (direction === "right") head[1]++;

        if (head[0] < 1 || head[0] > size || head[1] < 1 || head[1] > size) {
          gameOver();
          return;
        }

        if (
          snake.some(
            (segment) => segment[0] === head[0] && segment[1] === head[1]
          )
        ) {
          gameOver();
          return;
        }

        snake.unshift(head);

        if (head[0] === apple[0] && head[1] === apple[1]) {
          score++;
          document.getElementById("score").textContent = `Score: ${score}`;
          generateApple();
        } else {
          snake.pop();
        }

        updateBoard();
      }
      document.addEventListener("keydown", (e) => {
        gameRunning = true;
        if (e.key === "ArrowUp" && direction !== "down") direction = "up";
        else if (e.key === "ArrowDown" && direction !== "up")
          direction = "down";
        else if (e.key === "ArrowLeft" && direction !== "right")
          direction = "left";
        else if (e.key === "ArrowRight" && direction !== "left")
          direction = "right";
      });

      function gameOver() {
        gameRunning = false;
        alert(`Game Over! Score: ${score}`);
      }

      generateApple();
      updateBoard();

      setInterval(moveSnake, 150);
    </script>
  </body>
</html>